<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>eCourts Cause List Downloader (Demo)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container mt-5">
  <div class="card shadow p-4">
    <h3 class="text-center mb-3">eCourts Cause List Downloader (Demo)</h3>
    <form id="causeForm">
      <label>State</label>
      <select id="state" name="state" class="form-select mb-2" required></select>

      <label>District</label>
      <select id="district" name="district" class="form-select mb-2" required></select>

      <label>Court Complex</label>
      <select id="complex" name="complex" class="form-select mb-2" required></select>

      <label>Court (Optional)</label>
      <select id="court" name="court" class="form-select mb-2"></select>

      <label>Date</label>
      <input type="date" name="date" class="form-control mb-3" required>

      <button class="btn btn-primary w-100" type="submit">Download Cause List PDF</button>
    </form>
  </div>
</div>

<script>
async function loadData() {
  const res = await fetch('/get_data');
  const data = await res.json();

  const stateSel = document.getElementById('state');
  const distSel  = document.getElementById('district');
  const compSel  = document.getElementById('complex');
  const courtSel = document.getElementById('court');

  // Populate states
  for (const s in data) {
    const opt = document.createElement('option');
    opt.value = s; opt.textContent = s;
    stateSel.appendChild(opt);
  }

  stateSel.onchange = () => {
    distSel.innerHTML = '<option value="">-- Select District --</option>';
    compSel.innerHTML = '<option value="">-- Select Complex --</option>';
    courtSel.innerHTML = '<option value="">-- Optional --</option>';
    if (!stateSel.value) return;
    const dists = Object.keys(data[stateSel.value].districts);
    dists.forEach(d => distSel.innerHTML += `<option value="${d}">${d}</option>`);
  };

  distSel.onchange = () => {
    compSel.innerHTML = '<option value="">-- Select Complex --</option>';
    courtSel.innerHTML = '<option value="">-- Optional --</option>';
    if (!distSel.value) return;
    const comps = data[stateSel.value].districts[distSel.value].complexes;
    comps.forEach(c => compSel.innerHTML += `<option value="${c}">${c}</option>`);
  };

  compSel.onchange = () => {
    courtSel.innerHTML = '<option value="">-- Optional --</option>';
    if (!compSel.value) return;
    const courts = ["Judge A", "Judge B", "Judge C"];
    courts.forEach(c => courtSel.innerHTML += `<option value="${c}">${c}</option>`);
  };
}

document.addEventListener('DOMContentLoaded', loadData);

document.getElementById('causeForm').onsubmit = async e => {
  e.preventDefault();
  const form = new FormData(e.target);
  const res = await fetch('/download', {method: 'POST', body: form});
  const blob = await res.blob();
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'CauseList.pdf';
  a.click();
};
</script>
</body>
</html>
